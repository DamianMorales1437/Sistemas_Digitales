 // pwm y  filto pasa-bajos de segundo orden  señal sinosoidal de 87 HZ y 4 volts de amplitud
 
 const muestras=360;
 /* 64,65,66,67,68,69,71,72,73,74,75,76,77,78,79,80,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,101,102,103,104,105,106,107,108,108,109,110,111,111,112,113,114,114,115,116,116,117,118,118,119,119,120,120,121,121,122,122,123,123,124,124,124,125,125,125,126,126,126,126,127,127,127,127,127,127,127,128,128,128,128,128,128,128,128,128,127,127,127,127,127,127,126,126,126,126,125,125,125,124,124,124,123,123,122,122,122,121,121,120,120,119,118,118,117,117,116,115,115,114,113,113,112,111,110,110,109,108,107,106,105,105,104,103,102,101,100,99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,74,73,72,71,70,69,68,67,66,64,63,62,61,60,59,58,57,55,54,53,52,51,50,49,48,47,46,45,44,42,41,40,39,38,37,36,35,34,33,32,31,30,29,29,28,27,26,25,24,23,22,21,21,20,19,18,17,17,16,15,14,14,13,12,12,11,11,10,9,9,8,8,7,7,6,6,5,5,4,4,4,3,3,3,2,2,2,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,2,2,2,2,3,3,3,4,4,5,5,5,6,6,7,7,8,8,9,10,10,11,11,12,13,13,14,15,16,16,17,18,19,19,20,21,22,23,24,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,61,62,63,64
*/
 unsigned int onda[]={232,236,239,243,247,250,257,261,265,268,272,276,279,283,286,290,297,301,305,308,312,315,319,323,326,330,334,337,341,344,348,352,355,359,363,366,366,370,373,377,381,384,388,392,392,395,399,402,402,406,410,413,413,417,421,421,424,428,428,431,431,435,435,439,439,442,442,446,446,450,450,450,453,453,453,457,457,457,457,460,460,460,460,460,460,460,464,464,464,464,464,464,464,464,464,460,460,460,460,460,460,457,457,457,457,453,453,453,450,450,450,446,446,442,442,442,439,439,435,435,431,428,428,424,424,421,417,417,413,410,410,406,402,399,399,395,392,388,384,381,381,377,373,370,366,363,359,355,352,348,344,341,337,334,330,326,323,319,315,312,308,305,301,297,294,290,286,283,279,276,268,265,261,257,254,250,247,243,239,232,228,225,221,218,214,210,207,199,196,192,189,185,181,178,174,170,167,163,160,152,149,145,141,138,134,131,127,123,120,116,112,109,105,105,102,98,94,91,87,83,80,76,76,73,69,65,62,62,58,54,51,51,47,44,44,40,40,36,33,33,29,29,25,25,22,22,18,18,15,15,15,11,11,11,7,7,7,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,7,7,7,7,11,11,11,15,15,18,18,18,22,22,25,25,29,29,33,36,36,40,40,44,47,47,51,54,58,58,62,65,69,69,73,76,80,83,87,87,91,94,98,102,105,109,112,116,120,123,127,131,134,138,141,145,149,152,156,160,163,167,170,174,178,185,189,192,196,199,203,207,210,214,221,225,228,232
};   //frecuencia * 3.7
unsigned int es,eso;


//para variables
char LEEBIT (unsigned int port, char bit1)
{

    if ((port & (1 << bit1))>0) return (1);
    else return (0);
}

void interrpcion() iv 0x0008 ics ICS_AUTO 
{

  if (TMR2IF_bit==1)
{
eso++;
if (eso>=muestras-1) eso=0;

es=onda[eso];
   // carga los 9 bit ciclo util
 CCPR1L=es >> 2;// carga parte baja
DC1B1_bit=LEEBIT(es,1);// carga bit 1
DC1B0_bit=LEEBIT(es,0);  // carga bit 0
TMR2IF_bit=0;
}

}

void main() 
{

//Todo Digital
adcon1=0b1111;
INTCON=0b01000000;

//configuracon de los pines
TRISA=0;
trisc=0;// salida pwm


CCP1CON=0b00101100;// configura como pwm;

//configuracion frecuencia.
T2CON=0;

//programa frecuencia.
// PREESCALAODR A 4
T2CKPS1_bit=0;  //prescalador time 2
T2CKPS0_bit=1;  //prescalador time 2
PR2=143;            //registro pr2

  eso=0;
 es=onda[eso];
 // aramr el ciclo util deseado a 9 bits
 CCPR1L=es >> 2;

    if ((es & (1 << 1))>0) DC1B1_bit=1;
    else DC1B1_bit=0;

    if ((es & (1 << 0))>0) DC1B0_bit=1;
    else DC1B0_bit=0;

    // habilita int del timer2
TMR2IF_bit=0;
TMR2IE_bit=1;
GIE_bit=1;
TMR2ON_bit=1;//prende pwm


}